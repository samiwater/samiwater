<!doctype html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ورود | SamiWater</title>
  <style>
    :root{--green:#0f3b2e;--green2:#0b2e24;--gold:#d4af37;--gold2:#f1d26a}
    *{box-sizing:border-box}
    body{margin:0;background:linear-gradient(180deg,var(--green),var(--green2));color:#fff;
      font-family:Tahoma,Vazirmatn,sans-serif}
    .wrap{max-width:520px;margin:40px auto;padding:0 12px}
    .card{background:rgba(255,255,255,.03);border:1px solid rgba(212,175,55,.35);border-radius:16px;padding:16px}
    .brand{display:flex;align-items:center;gap:10px;margin-bottom:12px}
    .ico{width:42px;height:42px;border-radius:12px;border:1px solid rgba(212,175,55,.45);
      background:linear-gradient(145deg,#145,#0a3329);display:flex;align-items:center;justify-content:center;color:#f6e5a4;font-weight:800}
    label{display:block;margin:10px 4px 6px}
    input{width:100%;background:#0e2f25;color:#fff;border:1px solid rgba(212,175,55,.35);border-radius:10px;padding:10px}
    button{width:100%;margin-top:14px;background:linear-gradient(180deg,var(--gold2),var(--gold));color:#112;border:none;border-radius:12px;padding:12px;font-weight:700}
    .muted{color:#c9d6d2;font-size:13px;margin-top:8px}
    .pinRow,.otpRow{display:none}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="brand">
        <div class="ico">SA</div>
        <h2 style="margin:0">ورود | <span style="color:#f1d26a">SamiWater</span></h2>
      </div>

      <label>شماره موبایل</label>
      <input id="phone" placeholder="09131234567" inputmode="numeric" />

      <div class="pinRow" id="pinRow">
        <label>PIN (فقط برای مدیر)</label>
        <input id="pin" placeholder="مثلاً 2468" inputmode="numeric" />
      </div>

      <div class="otpRow" id="otpRow">
        <label>کد تأیید (تست)</label>
        <input id="otp" placeholder="111111" inputmode="numeric" />
      </div>

      <button id="btn">ادامه</button>
      <div class="muted">اگر با شماره مدیر وارد شوید، PIN را هم وارد کنید. (OTP تست: 111111)</div>
    </div>
  </div>

  <script>
    // ====== تنظیمات مدیر ======
    const ADMIN_PIN = "2468";
    const ADMIN_PHONES = ["09384129843"]; // می‌تونی بیشتر هم بذاری
    const normalize = (p) => (p||"").replace(/\D/g,"").slice(-10);
    const isAdminPhone = (p) => ADMIN_PHONES.map(normalize).includes(normalize(p));

    const phoneInput = document.getElementById("phone");
    const pinRow = document.getElementById("pinRow");
    const otpRow = document.getElementById("otpRow");
    const btn = document.getElementById("btn");

    // OTP تست را همیشه نشان بده (فعلاً)
    otpRow.style.display = "block";

    phoneInput.addEventListener("input", ()=>{
      pinRow.style.display = isAdminPhone(phoneInput.value) ? "block" : "none";
    });

    btn.onclick = ()=>{
      const phone = phoneInput.value.trim();
      const otp = (document.getElementById("otp").value||"").trim();
      if (!phone){ alert("شماره را وارد کنید"); return; }
      if (otp !== "111111"){ alert("کد تأیید نادرست است (تست: 111111)"); return; }

      let role = "user";
      if (isAdminPhone(phone)) {
        const pin = (document.getElementById("pin").value||"").trim();
        if (pin !== ADMIN_PIN){ alert("PIN مدیر اشتباه است"); return; }
        role = "admin";
      }

      // ذخیره‌ی وضعیت برای داشبورد
      localStorage.setItem("sw_role", role);
      localStorage.setItem("sw_phone", normalize(phone));
      localStorage.setItem("sw_token", "devtoken");
      localStorage.setItem("sw_api", "https://samiwater-backend.onrender.com");

      location.href = "dashboard.html";
    };
  </script>
</body>
</html>
