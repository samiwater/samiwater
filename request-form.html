<script>
  // دریافت پارامترهای URL
  const urlParams = new URLSearchParams(window.location.search);
  const phone = urlParams.get("phone");
  const type = urlParams.get("type");

  if (phone) document.getElementById("phone").value = phone;
  if (type) document.getElementById("serviceType").value = type;

  document.getElementById("request-form").addEventListener("submit", function(e) {
    e.preventDefault();
    const form = e.target;
    const data = new FormData(form);
    data.append("source", "درخواست فوری");

    document.getElementById("msg").innerHTML = "⏳ در حال ارسال اطلاعات...";

    fetch("https://script.google.com/macros/s/AKfycbz4hjQpslhBOi9XUmqnjp7y5x_umnQE-BhztWgI1KKhX1KMsOw0mZ2MDSFyhatTEMd8/exec", {
      method: "POST",
      body: data
    })
    .then(res => res.text())
    .then(txt => {
      document.getElementById("msg").innerHTML = "✅ پاسخ سرور: " + txt;
      form.reset();
      setTimeout(() => {
        window.location.href = "request-confirmed.html";
      }, 3000);
    })
    .catch(err => {
      document.getElementById("msg").innerHTML = "❌ خطا: اتصال برقرار نشد.<br>کد خطا: " + err;
      console.error(err);
    });
  });
</script>
