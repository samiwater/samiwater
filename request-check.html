<!doctype html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>بررسی شماره | SamiWater</title>
  <style>
    body{font-family:Tahoma,Arial,sans-serif;background:#f6f7fb;color:#222;margin:0}
    .wrap{max-width:480px;margin:24px auto;padding:16px}
    .card{background:#fff;border-radius:12px;box-shadow:0 6px 18px rgba(0,0,0,.06);padding:18px}
    .title{font-size:18px;margin-bottom:12px}
    .input{width:100%;padding:12px;border:1px solid #ddd;border-radius:10px;font-size:16px}
    .btn{width:100%;margin-top:12px;background:#0ea5e9;color:#fff;border:0;padding:12px;border-radius:10px;font-size:16px}
    .hint{font-size:12px;color:#666;margin-top:8px}
    .msg{margin-top:10px;font-size:14px}
  </style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <div class="title">بررسی شماره موبایل</div>
    <input id="phone" class="input" inputmode="numeric" placeholder="مثلاً 09131234567" />
    <button class="btn" onclick="checkPhone()">ادامه</button>
    <div id="result" class="msg"></div>
    <div class="hint">شماره وارد شده برای پیدا کردن سوابق شما استفاده می‌شود.</div>
  </div>
</div>

<script>
  const API_BASE = "https://samiwater-backend.onrender.com/api";

  function checkPhone() {
    const phoneEl = document.getElementById("phone");
    const result = document.getElementById("result");
    const phone = (phoneEl.value || "").trim();

    if (!/^09\d{9}$/.test(phone)) {
      result.textContent = "❌ لطفاً شماره موبایل معتبر (11 رقمی) وارد کنید.";
      return;
    }

    result.textContent = "در حال بررسی...";
    sessionStorage.setItem("samiwater_phone", phone);
    sessionStorage.setItem("samiwater_type", "web_form");

    fetch(`${API_BASE}/customers/phone/${encodeURIComponent(phone)}`)
      .then(async (res) => {
        // چه مشتری پیدا شود چه نه، می‌رویم به فرم (در فرم اگر مشتری نبود، ساخته می‌شود)
        window.location.href = "request-form.html";
      })
      .catch((e) => {
        console.error(e);
        result.textContent = "❌ اتصال به سرور برقرار نشد. دوباره تلاش کنید.";
      });
  }
</script>
</body>
</html>
